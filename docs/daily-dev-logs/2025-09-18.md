# 2025-09-18 작업 기록

## 드라이버 앱 분리 및 초기 세팅

- `driverApp/`를 신설해 기존 승객용 화면을 복사한 뒤 드라이버 전용 네비게이션(`DriverApp.tsx`, `index.tsx`)으로 재구성했고, 아이콘/텍스트를 기사 맥락에 맞게 조정했습니다.
- `driverApp/src/Main_List.tsx`에 호출 상태 필터(전체·REQ·RES)와 수락 버튼을 추가하고, `API.tsx`는 `/driver/login|register|list|accept` 엔드포인트를 사용하는 전용 래퍼로 분리했습니다.
- 양쪽 앱 모두 `postinstall`에 `patch-package`를 연결하고, 공통 라이브러리(지도/Places/geolocation 등)를 동일하게 유지했습니다.

## Firebase Cloud Messaging 연동

- `taxiApp`과 `driverApp`에 `@react-native-firebase/app`, `@react-native-firebase/messaging`을 설치하고, `TaxiApp.tsx`, `DriverApp.tsx`에서 FCM 토큰을 초기화(AsyncStorage 저장)한 뒤 포그라운드 메시지를 Alert로 노출하도록 설정했습니다.
- `google-services.json`을 각 Android 앱에 배치하고 `gradlew signingReport`로 추출한 SHA1을 Firebase 콘솔에 등록해 두 앱 모두에서 FCM 인증을 완료했습니다.
- 승객/기사 로그인·회원가입 시 FCM 토큰을 함께 전송하도록 `taxiApp/src/API.tsx`, `driverApp/src/API.tsx` 및 각 `Login.tsx`, `Register.tsx`를 수정했습니다.

## 호출/배차 Push 플로우 구현

- 서버 `/taxi/register|login`, `/driver/register|login`이 전달받은 FCM 토큰을 각각 `tb_user`, `tb_driver`에 저장하게 변경하고, `/taxi/call` → 기사 전체 푸시, `/driver/accept` → 해당 승객 푸시 흐름을 점검했습니다 (`server/routes/index.js`).
- 승객 앱과 드라이버 앱의 `Main_List.tsx` 모두에서 `messaging().onMessage` 수신 시 즉시 목록을 갱신하도록 구현했으며, 승객 목록은 `RES` 상태를 파란색으로 강조하고 드라이버 목록은 `REQ` 상태일 때만 수락 버튼을 노출합니다.

## 기타 메모 / TODO

- driverApp 디버그 keystore를 새로 생성했으므로 배포 서명/환경 분리 전략을 후속으로 정리해야 합니다.
- DB 스키마의 `tb_call.requert_time` 컬럼 오탈자 여부를 확인해 명세와 일치시키는 작업이 필요합니다.
- 두 앱의 Axios `baseURL`과 FCM 키 관리를 환경별로 외부화하는 방안을 정리해야 합니다.
